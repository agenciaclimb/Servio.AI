
> servio-ai-backend@1.0.0 test
> vitest run --coverage


[1m[46m RUN [49m[22m [36mv4.0.16 [39m[90mC:/Users/JE/servio.ai/backend[39m
      [2mCoverage enabled with [22m[33mv8[39m

13:37:17 [vite] (ssr) warning: Duplicate key "firestore" in object literal
71 |        })),
72 |      })),
73 |      firestore: {
   |      ^
74 |        Timestamp: {
75 |          now: () => new Date(),

  Plugin: vite:esbuild
  File: C:/Users/JE/servio.ai/backend/tests/services/landingPageService.test.ts
 [31mÃ”Ã˜Â»[39m tests/followUpService.test.js [2m([22m[2m4 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 59[2mms[22m[39m
     [32mÃ”Â£Ã´[39m creates schedule with expected steps[32m 8[2mms[22m[39m
     [32mÃ”Â£Ã´[39m pause/resume/optOut modifies flags[32m 4[2mms[22m[39m
     [32mÃ”Â£Ã´[39m processDueEmails sends due steps when not rate limited[32m 9[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m rate limiting logic (mock environment)[39m[32m 20[2mms[22m[39m
 [31mÃ”Ã˜Â»[39m tests/services/whatsappService.test.ts [2m([22m[2m21 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 131[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should send text message successfully[32m 21[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should format phone number correctly[32m 5[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should throw error on API failure[32m 8[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should send template message successfully[32m 6[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should use default language if not provided[32m 4[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should throw error on template send failure[32m 3[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should send interactive message successfully[32m 5[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should throw error on interactive send failure[32m 3[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should handle FAQ response[32m 8[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should escalate unknown queries[39m[32m 27[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should retrieve conversation history[32m 5[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should return empty array if no messages[32m 2[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should throw error on retrieval failure[32m 2[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should close conversation successfully[32m 2[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should throw error on close failure[32m 2[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should retrieve active conversations[32m 6[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should respect limit parameter[32m 2[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should return empty array if no active conversations[32m 3[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should return true for valid token[32m 3[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should return false for invalid token[32m 1[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should return bot suggestions[32m 2[2mms[22m[39m
 [31mÃ”Ã˜Â»[39m tests/services/twilioService.test.ts [2m([22m[2m22 tests[22m[2m | [22m[31m22 failed[39m[2m)[22m[32m 125[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should send SMS successfully with valid payload[39m[32m 34[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should fail with invalid phone number[39m[32m 4[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should fail with non-existent template[39m[32m 4[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should interpolate variables in message[39m[32m 23[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should initiate voice call successfully[39m[32m 3[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should fail voice call with invalid phone number[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should send both SMS and voice when channel is "both"[39m[32m 3[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should send only SMS when channel is "sms"[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should retrieve user communication preferences[39m[32m 4[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return null for non-existent user[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update communication preferences successfully[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should set preferences with all fields[39m[32m 3[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return all available templates[39m[32m 3[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should have proper template structure[39m[32m 3[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should add custom template[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle Twilio API errors gracefully[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle missing Firestore data gracefully[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should replace all template variables[39m[32m 3[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle empty variables object[39m[32m 4[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should support SMS channel[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should support voice channel[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should support both channels simultaneously[39m[32m 2[2mms[22m[39m
 [31mÃ”Ã˜Â»[39m tests/services/landingPageService.test.ts [2m([22m[2m22 tests[22m[2m | [22m[31m21 failed[39m[2m)[22m[32m 134[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should generate landing page successfully[39m[32m 46[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should include SEO metadata[39m[32m 3[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should generate FAQ items[39m[32m 3[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should generate A/B test variants[39m[32m 4[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should include all briefing options[39m[32m 3[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should fetch landing page by ID[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return null for non-existent page[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list user landing pages[39m[32m 3[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should respect limit parameter[39m[32m 4[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should record page view[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should accept any variant[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should record conversion without amount[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should record conversion with amount[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return A/B test results[39m[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle missing variants[39m[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete landing page[39m[32m 9[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should generate SEO-friendly headline[39m[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should include target keywords[39m[32m 4[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should include clear CTA[39m[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should have compelling subheadline[39m[32m 2[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should handle generation errors gracefully[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should use defaults for missing Gemini response fields[39m[32m 2[2mms[22m[39m
[90mstdout[2m | tests/gmailService.test.js[2m > [22m[2mgmailService[2m > [22m[2mverifies SMTP connection
[22m[39m[Gmail] SMTP server is ready to send emails

[90mstdout[2m | tests/gmailService.test.js[2m > [22m[2mgmailService[2m > [22m[2msends a basic email with default from
[22m[39m[Gmail] Email sent: <mock-1766421439938@servio-ai.com> to: to@example.com

[90mstdout[2m | tests/gmailService.test.js[2m > [22m[2mgmailService[2m > [22m[2msendProspectorInvite composes expected subject and link
[22m[39m[Gmail] Email sent: <mock-1766421439949@servio-ai.com> to: joao@example.com

[90mstdout[2m | tests/gmailService.test.js[2m > [22m[2mgmailService[2m > [22m[2msendFollowUpReminder composes expected subject
[22m[39m[Gmail] Email sent: <mock-1766421439955@servio-ai.com> to: maria@example.com

[90mstdout[2m | tests/gmailService.test.js[2m > [22m[2mgmailService[2m > [22m[2msendConversionNotification formats commission value
[22m[39m[Gmail] Email sent: <mock-1766421439960@servio-ai.com> to: ana@example.com

 [32mÃ”Â£Ã´[39m tests/gmailService.test.js [2m([22m[2m5 tests[22m[2m)[22m[33m 440[2mms[22m[39m
     [33m[2mÃ”Â£Ã´[22m[39m verifies SMTP connection [33m 407[2mms[22m[39m
[90mstdout[2m | tests/dbWrapper.test.js[2m > [22m[2mdbWrapper - Memory Fallback System[2m > [22m[2mModo Memâ”œâ”‚ria[2m > [22m[2mdeve detectar modo memâ”œâ”‚ria quando sem Project ID
[22m[39m[DB] Memâ”œâ”‚ria limpa

stderr | tests/dbWrapper.test.js > dbWrapper - Memory Fallback System > Modo Memâ”œâ”‚ria > deve detectar modo memâ”œâ”‚ria quando sem Project ID
[DB] Ã”ÃœÃ¡Â´Â©Ã…  Modo memâ”œâ”‚ria forâ”œÂºado para testes

[90mstdout[2m | tests/dbWrapper.test.js[2m > [22m[2mdbWrapper - Memory Fallback System[2m > [22m[2mModo Memâ”œâ”‚ria[2m > [22m[2mdeve ter mâ”œÂ®todos principais disponâ”œÂ¡veis
[22m[39m[DB] Memâ”œâ”‚ria limpa

stderr | tests/dbWrapper.test.js > dbWrapper - Memory Fallback System > Modo Memâ”œâ”‚ria > deve ter mâ”œÂ®todos principais disponâ”œÂ¡veis
[DB] Ã”ÃœÃ¡Â´Â©Ã…  Modo memâ”œâ”‚ria forâ”œÂºado para testes

[90mstdout[2m | tests/dbWrapper.test.js[2m > [22m[2mdbWrapper - Memory Fallback System[2m > [22m[2mOperaâ”œÂºâ”œÃes CRUD[2m > [22m[2mdeve criar documento com set()
[22m[39m[DB] Memâ”œâ”‚ria limpa

stderr | tests/dbWrapper.test.js > dbWrapper - Memory Fallback System > Operaâ”œÂºâ”œÃes CRUD > deve criar documento com set()
[DB] Ã”ÃœÃ¡Â´Â©Ã…  Modo memâ”œâ”‚ria forâ”œÂºado para testes

[90mstdout[2m | tests/dbWrapper.test.js[2m > [22m[2mdbWrapper - Memory Fallback System[2m > [22m[2mOperaâ”œÂºâ”œÃes CRUD[2m > [22m[2mdeve gerar ID automâ”œÃ­tico quando doc() chamado sem argumento
[22m[39m[DB] Memâ”œâ”‚ria limpa

stderr | tests/dbWrapper.test.js > dbWrapper - Memory Fallback System > Operaâ”œÂºâ”œÃes CRUD > deve gerar ID automâ”œÃ­tico quando doc() chamado sem argumento
[DB] Ã”ÃœÃ¡Â´Â©Ã…  Modo memâ”œâ”‚ria forâ”œÂºado para testes

[90mstdout[2m | tests/dbWrapper.test.js[2m > [22m[2mdbWrapper - Memory Fallback System[2m > [22m[2mOperaâ”œÂºâ”œÃes CRUD[2m > [22m[2mdeve atualizar documento com update()
[22m[39m[DB] Memâ”œâ”‚ria limpa

stderr | tests/dbWrapper.test.js > dbWrapper - Memory Fallback System > Operaâ”œÂºâ”œÃes CRUD > deve atualizar documento com update()
[DB] Ã”ÃœÃ¡Â´Â©Ã…  Modo memâ”œâ”‚ria forâ”œÂºado para testes

[90mstdout[2m | tests/dbWrapper.test.js[2m > [22m[2mdbWrapper - Memory Fallback System[2m > [22m[2mOperaâ”œÂºâ”œÃes CRUD[2m > [22m[2mdeve fazer merge com set({ merge: true })
[22m[39m[DB] Memâ”œâ”‚ria limpa

stderr | tests/dbWrapper.test.js > dbWrapper - Memory Fallback System > Operaâ”œÂºâ”œÃes CRUD > deve fazer merge com set({ merge: true })
[DB] Ã”ÃœÃ¡Â´Â©Ã…  Modo memâ”œâ”‚ria forâ”œÂºado para testes

[90mstdout[2m | tests/dbWrapper.test.js[2m > [22m[2mdbWrapper - Memory Fallback System[2m > [22m[2mOperaâ”œÂºâ”œÃes CRUD[2m > [22m[2mdeve deletar documento
[22m[39m[DB] Memâ”œâ”‚ria limpa

stderr | tests/dbWrapper.test.js > dbWrapper - Memory Fallback System > Operaâ”œÂºâ”œÃes CRUD > deve deletar documento
[DB] Ã”ÃœÃ¡Â´Â©Ã…  Modo memâ”œâ”‚ria forâ”œÂºado para testes

[90mstdout[2m | tests/dbWrapper.test.js[2m > [22m[2mdbWrapper - Memory Fallback System[2m > [22m[2mOperaâ”œÂºâ”œÃes CRUD[2m > [22m[2mdeve adicionar documento com add()
[22m[39m[DB] Memâ”œâ”‚ria limpa

stderr | tests/dbWrapper.test.js > dbWrapper - Memory Fallback System > Operaâ”œÂºâ”œÃes CRUD > deve adicionar documento com add()
[DB] Ã”ÃœÃ¡Â´Â©Ã…  Modo memâ”œâ”‚ria forâ”œÂºado para testes

[90mstdout[2m | tests/dbWrapper.test.js[2m > [22m[2mdbWrapper - Memory Fallback System[2m > [22m[2mQueries[2m > [22m[2mdeve filtrar com where()
[22m[39m[DB] Memâ”œâ”‚ria limpa

stderr | tests/dbWrapper.test.js > dbWrapper - Memory Fallback System > Queries > deve filtrar com where()
[DB] Ã”ÃœÃ¡Â´Â©Ã…  Modo memâ”œâ”‚ria forâ”œÂºado para testes

[90mstdout[2m | tests/dbWrapper.test.js[2m > [22m[2mdbWrapper - Memory Fallback System[2m > [22m[2mQueries[2m > [22m[2mdeve limitar resultados com limit()
[22m[39m[DB] Memâ”œâ”‚ria limpa

stderr | tests/dbWrapper.test.js > dbWrapper - Memory Fallback System > Queries > deve limitar resultados com limit()
[DB] Ã”ÃœÃ¡Â´Â©Ã…  Modo memâ”œâ”‚ria forâ”œÂºado para testes

[90mstdout[2m | tests/dbWrapper.test.js[2m > [22m[2mdbWrapper - Memory Fallback System[2m > [22m[2mQueries[2m > [22m[2mdeve ordenar com orderBy()
[22m[39m[DB] Memâ”œâ”‚ria limpa

stderr | tests/dbWrapper.test.js > dbWrapper - Memory Fallback System > Queries > deve ordenar com orderBy()
[DB] Ã”ÃœÃ¡Â´Â©Ã…  Modo memâ”œâ”‚ria forâ”œÂºado para testes

[90mstdout[2m | tests/dbWrapper.test.js[2m > [22m[2mdbWrapper - Memory Fallback System[2m > [22m[2mQueries[2m > [22m[2mdeve combinar where + orderBy + limit
[22m[39m[DB] Memâ”œâ”‚ria limpa

stderr | tests/dbWrapper.test.js > dbWrapper - Memory Fallback System > Queries > deve combinar where + orderBy + limit
[DB] Ã”ÃœÃ¡Â´Â©Ã…  Modo memâ”œâ”‚ria forâ”œÂºado para testes

[90mstdout[2m | tests/dbWrapper.test.js[2m > [22m[2mdbWrapper - Memory Fallback System[2m > [22m[2mfieldValueHelpers[2m > [22m[2mdeve processar increment()
[22m[39m[DB] Memâ”œâ”‚ria limpa

stderr | tests/dbWrapper.test.js > dbWrapper - Memory Fallback System > fieldValueHelpers > deve processar increment()
[DB] Ã”ÃœÃ¡Â´Â©Ã…  Modo memâ”œâ”‚ria forâ”œÂºado para testes

[90mstdout[2m | tests/dbWrapper.test.js[2m > [22m[2mdbWrapper - Memory Fallback System[2m > [22m[2mfieldValueHelpers[2m > [22m[2mdeve processar serverTimestamp()
[22m[39m[DB] Memâ”œâ”‚ria limpa

stderr | tests/dbWrapper.test.js > dbWrapper - Memory Fallback System > fieldValueHelpers > deve processar serverTimestamp()
[DB] Ã”ÃœÃ¡Â´Â©Ã…  Modo memâ”œâ”‚ria forâ”œÂºado para testes

[90mstdout[2m | tests/dbWrapper.test.js[2m > [22m[2mdbWrapper - Memory Fallback System[2m > [22m[2mfieldValueHelpers[2m > [22m[2mdeve processar arrayUnion()
[22m[39m[DB] Memâ”œâ”‚ria limpa

stderr | tests/dbWrapper.test.js > dbWrapper - Memory Fallback System > fieldValueHelpers > deve processar arrayUnion()
[DB] Ã”ÃœÃ¡Â´Â©Ã…  Modo memâ”œâ”‚ria forâ”œÂºado para testes

[90mstdout[2m | tests/dbWrapper.test.js[2m > [22m[2mdbWrapper - Memory Fallback System[2m > [22m[2mfieldValueHelpers[2m > [22m[2mdeve processar arrayRemove()
[22m[39m[DB] Memâ”œâ”‚ria limpa

stderr | tests/dbWrapper.test.js > dbWrapper - Memory Fallback System > fieldValueHelpers > deve processar arrayRemove()
[DB] Ã”ÃœÃ¡Â´Â©Ã…  Modo memâ”œâ”‚ria forâ”œÂºado para testes

[90mstdout[2m | tests/dbWrapper.test.js[2m > [22m[2mdbWrapper - Memory Fallback System[2m > [22m[2mExport e Debug[2m > [22m[2mdeve exportar dados com _exportMemory()
[22m[39m[DB] Memâ”œâ”‚ria limpa

stderr | tests/dbWrapper.test.js > dbWrapper - Memory Fallback System > Export e Debug > deve exportar dados com _exportMemory()
[DB] Ã”ÃœÃ¡Â´Â©Ã…  Modo memâ”œâ”‚ria forâ”œÂºado para testes

[90mstdout[2m | tests/dbWrapper.test.js[2m > [22m[2mdbWrapper - Memory Fallback System[2m > [22m[2mExport e Debug[2m > [22m[2mdeve limpar dados com _clearMemory()
[22m[39m[DB] Memâ”œâ”‚ria limpa

stderr | tests/dbWrapper.test.js > dbWrapper - Memory Fallback System > Export e Debug > deve limpar dados com _clearMemory()
[DB] Ã”ÃœÃ¡Â´Â©Ã…  Modo memâ”œâ”‚ria forâ”œÂºado para testes

[90mstdout[2m | tests/dbWrapper.test.js[2m > [22m[2mdbWrapper - Memory Fallback System[2m > [22m[2mExport e Debug[2m > [22m[2mdeve limpar dados com _clearMemory()
[22m[39m[DB] Memâ”œâ”‚ria limpa

[90mstdout[2m | tests/dbWrapper.test.js[2m > [22m[2mdbWrapper - Memory Fallback System[2m > [22m[2mComportamento do snapshot[2m > [22m[2msnapshot deve ter propriedade exists
[22m[39m[DB] Memâ”œâ”‚ria limpa

stderr | tests/dbWrapper.test.js > dbWrapper - Memory Fallback System > Comportamento do snapshot > snapshot deve ter propriedade exists
[DB] Ã”ÃœÃ¡Â´Â©Ã…  Modo memâ”œâ”‚ria forâ”œÂºado para testes

[90mstdout[2m | tests/dbWrapper.test.js[2m > [22m[2mdbWrapper - Memory Fallback System[2m > [22m[2mComportamento do snapshot[2m > [22m[2msnapshot deve ter propriedade id
[22m[39m[DB] Memâ”œâ”‚ria limpa

stderr | tests/dbWrapper.test.js > dbWrapper - Memory Fallback System > Comportamento do snapshot > snapshot deve ter propriedade id
[DB] Ã”ÃœÃ¡Â´Â©Ã…  Modo memâ”œâ”‚ria forâ”œÂºado para testes

[90mstdout[2m | tests/dbWrapper.test.js[2m > [22m[2mdbWrapper - Memory Fallback System[2m > [22m[2mComportamento do snapshot[2m > [22m[2msnapshot.docs deve ter map
[22m[39m[DB] Memâ”œâ”‚ria limpa

stderr | tests/dbWrapper.test.js > dbWrapper - Memory Fallback System > Comportamento do snapshot > snapshot.docs deve ter map
[DB] Ã”ÃœÃ¡Â´Â©Ã…  Modo memâ”œâ”‚ria forâ”œÂºado para testes

 [32mÃ”Â£Ã´[39m tests/authorizationMiddleware.test.js [2m([22m[2m9 tests[22m[2m)[22m[32m 86[2mms[22m[39m
 [32mÃ”Â£Ã´[39m tests/dbWrapper.test.js [2m([22m[2m21 tests[22m[2m)[22m[32m 139[2mms[22m[39m
 [32mÃ”Â£Ã´[39m tests/securityHardening.middleware.test.js [2m([22m[2m3 tests[22m[2m)[22m[33m 657[2mms[22m[39m
     [33m[2mÃ”Â£Ã´[22m[39m should export security headers helpers [33m 365[2mms[22m[39m
 [32mÃ”Â£Ã´[39m tests/user-uid-field.test.js [2m([22m[2m13 tests[22m[2m)[22m[32m 109[2mms[22m[39m
[90mstdout[2m | tests/omnichannel.test.js[2m > [22m[2mOmnichannel Service - Webhooks[2m > [22m[2mPOST /api/omni/webhook/whatsapp[2m > [22m[2mdeve processar mensagem do WhatsApp e salvar no Firestore
[22m[39m[Omni WA] Mensagem de 5511999999999: Olâ”œÃ­, preciso de ajuda

stderr | tests/services/ecommerceService.test.js > E-commerce Service > Product Management > should reject product creation with invalid price
Error creating product: Error: Invalid product data: name, sku, and valid price required
    at Module.createProduct (C:/Users/JE/servio.ai/backend/src/services/ecommerceService.js:68:13)
    at C:/Users/JE/servio.ai/backend/tests/services/ecommerceService.test.js:103:37
    at file:///C:/Users/JE/servio.ai/backend/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///C:/Users/JE/servio.ai/backend/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///C:/Users/JE/servio.ai/backend/node_modules/@vitest/runner/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/JE/servio.ai/backend/node_modules/@vitest/runner/dist/index.js:1209:10)
    at file:///C:/Users/JE/servio.ai/backend/node_modules/@vitest/runner/dist/index.js:1653:37
    at Traces.$ (file:///C:/Users/JE/servio.ai/backend/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
    at trace (file:///C:/Users/JE/servio.ai/backend/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)

stderr | tests/services/ecommerceService.test.js > E-commerce Service > Cart Management > should reject adding item with insufficient stock
Error adding to cart: Error: Insufficient stock. Available: 1
    at Module.addToCart (C:/Users/JE/servio.ai/backend/src/services/ecommerceService.js:138:13)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at C:/Users/JE/servio.ai/backend/tests/services/ecommerceService.test.js:158:7
    at file:///C:/Users/JE/servio.ai/backend/node_modules/@vitest/runner/dist/index.js:915:20

stderr | tests/services/ecommerceService.test.js > E-commerce Service > Checkout & Payment > should reject checkout with empty cart
Error creating checkout session: Error: Cart is empty
    at Module.createCheckoutSession (C:/Users/JE/servio.ai/backend/src/services/ecommerceService.js:283:13)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at C:/Users/JE/servio.ai/backend/tests/services/ecommerceService.test.js:226:7
    at file:///C:/Users/JE/servio.ai/backend/node_modules/@vitest/runner/dist/index.js:915:20

 [32mÃ”Â£Ã´[39m tests/services/ecommerceService.test.js [2m([22m[2m15 tests[22m[2m)[22m[32m 179[2mms[22m[39m
stderr | tests/omnichannel.test.js > Omnichannel Service - Webhooks > POST /api/omni/webhook/whatsapp > deve processar mensagem do WhatsApp e salvar no Firestore
[Omni IA] Erro: GoogleGenerativeAIFetchError: [GoogleGenerativeAI Error]: Error fetching from https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent: [400 Bad Request] API key not valid. Please pass a valid API key. [{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key not valid. Please pass a valid API key."}]
    at handleResponseNotOk (C:\Users\JE\servio.ai\backend\node_modules\@google\generative-ai\dist\index.js:434:11)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at makeRequest (C:\Users\JE\servio.ai\backend\node_modules\@google\generative-ai\dist\index.js:403:9)
    at generateContent (C:\Users\JE\servio.ai\backend\node_modules\@google\generative-ai\dist\index.js:867:22)
    at processWithOmniIA (C:\Users\JE\servio.ai\backend\src\services\omnichannel\index.js:486:20)
    at processWhatsAppMessage (C:\Users\JE\servio.ai\backend\src\services\omnichannel\index.js:245:22)
    at C:\Users\JE\servio.ai\backend\src\services\omnichannel\index.js:47:9 {
  status: 400,
  statusText: 'Bad Request',
  errorDetails: [
    {
      '@type': 'type.googleapis.com/google.rpc.ErrorInfo',
      reason: 'API_KEY_INVALID',
      domain: 'googleapis.com',
      metadata: [Object]
    },
    {
      '@type': 'type.googleapis.com/google.rpc.LocalizedMessage',
      locale: 'en-US',
      message: 'API key not valid. Please pass a valid API key.'
    }
  ]
}

stderr | tests/omnichannel.test.js > Omnichannel Service - Webhooks > POST /api/omni/webhook/whatsapp > deve processar mensagem do WhatsApp e salvar no Firestore
[Omni WA] Erro ao enviar: {
  error: {
    message: 'Invalid OAuth access token - Cannot parse access token',
    type: 'OAuthException',
    code: 190,
    fbtrace_id: 'AyCLTc3MbEO85OJ3w9zA2Wm'
  }
}

stderr | tests/omnichannel.test.js > Omnichannel Service - Webhooks > POST /api/omni/webhook/instagram > deve processar mensagem do Instagram
[Omni IA] Erro: GoogleGenerativeAIFetchError: [GoogleGenerativeAI Error]: Error fetching from https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent: [400 Bad Request] API key not valid. Please pass a valid API key. [{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key not valid. Please pass a valid API key."}]
    at handleResponseNotOk (C:\Users\JE\servio.ai\backend\node_modules\@google\generative-ai\dist\index.js:434:11)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at makeRequest (C:\Users\JE\servio.ai\backend\node_modules\@google\generative-ai\dist\index.js:403:9)
    at generateContent (C:\Users\JE\servio.ai\backend\node_modules\@google\generative-ai\dist\index.js:867:22)
    at processWithOmniIA (C:\Users\JE\servio.ai\backend\src\services\omnichannel\index.js:486:20)
    at processInstagramMessage (C:\Users\JE\servio.ai\backend\src\services\omnichannel\index.js:281:22)
    at C:\Users\JE\servio.ai\backend\src\services\omnichannel\index.js:74:11 {
  status: 400,
  statusText: 'Bad Request',
  errorDetails: [
    {
      '@type': 'type.googleapis.com/google.rpc.ErrorInfo',
      reason: 'API_KEY_INVALID',
      domain: 'googleapis.com',
      metadata: [Object]
    },
    {
      '@type': 'type.googleapis.com/google.rpc.LocalizedMessage',
      locale: 'en-US',
      message: 'API key not valid. Please pass a valid API key.'
    }
  ]
}

stderr | tests/omnichannel.test.js > Omnichannel Service - Webhooks > POST /api/omni/webhook/instagram > deve processar mensagem do Instagram
[Omni IG] Erro ao enviar: {
  error: {
    message: 'Invalid OAuth access token - Cannot parse access token',
    type: 'OAuthException',
    code: 190,
    fbtrace_id: 'A60r5RkS5EdG9N9bdgJbckB'
  }
}

stderr | tests/omnichannel.test.js > Omnichannel Service - Webhooks > POST /api/omni/webhook/facebook > deve processar mensagem do Facebook Messenger
[Omni IA] Erro: GoogleGenerativeAIFetchError: [GoogleGenerativeAI Error]: Error fetching from https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent: [400 Bad Request] API key not valid. Please pass a valid API key. [{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key not valid. Please pass a valid API key."}]
    at handleResponseNotOk (C:\Users\JE\servio.ai\backend\node_modules\@google\generative-ai\dist\index.js:434:11)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at makeRequest (C:\Users\JE\servio.ai\backend\node_modules\@google\generative-ai\dist\index.js:403:9)
    at generateContent (C:\Users\JE\servio.ai\backend\node_modules\@google\generative-ai\dist\index.js:867:22)
    at processWithOmniIA (C:\Users\JE\servio.ai\backend\src\services\omnichannel\index.js:486:20)
    at processFacebookMessage (C:\Users\JE\servio.ai\backend\src\services\omnichannel\index.js:315:22)
    at C:\Users\JE\servio.ai\backend\src\services\omnichannel\index.js:102:11 {
  status: 400,
  statusText: 'Bad Request',
  errorDetails: [
    {
      '@type': 'type.googleapis.com/google.rpc.ErrorInfo',
      reason: 'API_KEY_INVALID',
      domain: 'googleapis.com',
      metadata: [Object]
    },
    {
      '@type': 'type.googleapis.com/google.rpc.LocalizedMessage',
      locale: 'en-US',
      message: 'API key not valid. Please pass a valid API key.'
    }
  ]
}

stderr | tests/omnichannel.test.js > Omnichannel Service - Webhooks > POST /api/omni/webhook/facebook > deve processar mensagem do Facebook Messenger
[Omni FB] Erro ao enviar: {
  error: {
    message: 'Invalid OAuth access token - Cannot parse access token',
    type: 'OAuthException',
    code: 190,
    fbtrace_id: 'A9jHlvAnhHX4eg4DcUnOjue'
  }
}

[90mstdout[2m | tests/jobs-pagination.test.js
[22m[39m[2025-12-22T16:37:24.439Z] [WARN] Ã”ÃœÃ¡Â´Â©Ã…  WhatsApp credentials not configured - service disabled
[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"
[SERVER] Module loaded as dependency, not starting server

stderr | tests/jobs-pagination.test.js
[DB] Ã”ÃœÃ¡Â´Â©Ã…  No Google Cloud Project ID found - usando armazenamento em memâ”œâ”‚ria
[Stripe] STRIPE_SECRET_KEY missing Ã”Ã‡Ã´ Stripe features disabled
Ã”ÃœÃ¡Â´Â©Ã…  SENDGRID_API_KEY nâ”œÃºo configurada - emails nâ”œÃºo serâ”œÃºo enviados
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

[90mstdout[2m | tests/rateLimit.test.js
[22m[39m[2025-12-22T16:37:24.407Z] [WARN] Ã”ÃœÃ¡Â´Â©Ã…  WhatsApp credentials not configured - service disabled
[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"
[SERVER] Module loaded as dependency, not starting server

stderr | tests/rateLimit.test.js
[DB] Ã”ÃœÃ¡Â´Â©Ã…  No Google Cloud Project ID found - usando armazenamento em memâ”œâ”‚ria
[Stripe] STRIPE_SECRET_KEY missing Ã”Ã‡Ã´ Stripe features disabled
Ã”ÃœÃ¡Â´Â©Ã…  SENDGRID_API_KEY nâ”œÃºo configurada - emails nâ”œÃºo serâ”œÃºo enviados
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

[90mstdout[2m | tests/outreachAutomation.test.js
[22m[39m[2025-12-22T16:37:24.425Z] [WARN] Ã”ÃœÃ¡Â´Â©Ã…  WhatsApp credentials not configured - service disabled
[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"
[SERVER] Module loaded as dependency, not starting server

stderr | tests/outreachAutomation.test.js
[DB] Ã”ÃœÃ¡Â´Â©Ã…  No Google Cloud Project ID found - usando armazenamento em memâ”œâ”‚ria
[Stripe] STRIPE_SECRET_KEY missing Ã”Ã‡Ã´ Stripe features disabled
Ã”ÃœÃ¡Â´Â©Ã…  SENDGRID_API_KEY nâ”œÃºo configurada - emails nâ”œÃºo serâ”œÃºo enviados
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

[90mstdout[2m | tests/rateLimit.test.js[2m > [22m[2mRate limiting - critical endpoints[2m > [22m[2mpermite requisiâ”œÂºâ”œÃes dentro do limite configurado
[22m[39m[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"

stderr | tests/rateLimit.test.js > Rate limiting - critical endpoints > permite requisiâ”œÂºâ”œÃes dentro do limite configurado
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

stderr | tests/omnichannel.test.js > Omnichannel Service - Webhooks > POST /api/omni/web/send > deve enviar mensagem via WebChat e receber resposta da IA
[Omni IA] Erro: GoogleGenerativeAIFetchError: [GoogleGenerativeAI Error]: Error fetching from https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent: [400 Bad Request] API key not valid. Please pass a valid API key. [{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key not valid. Please pass a valid API key."}]
    at handleResponseNotOk (C:\Users\JE\servio.ai\backend\node_modules\@google\generative-ai\dist\index.js:434:11)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at makeRequest (C:\Users\JE\servio.ai\backend\node_modules\@google\generative-ai\dist\index.js:403:9)
    at generateContent (C:\Users\JE\servio.ai\backend\node_modules\@google\generative-ai\dist\index.js:867:22)
    at processWithOmniIA (C:\Users\JE\servio.ai\backend\src\services\omnichannel\index.js:486:20)
    at C:\Users\JE\servio.ai\backend\src\services\omnichannel\index.js:139:24 {
  status: 400,
  statusText: 'Bad Request',
  errorDetails: [
    {
      '@type': 'type.googleapis.com/google.rpc.ErrorInfo',
      reason: 'API_KEY_INVALID',
      domain: 'googleapis.com',
      metadata: [Object]
    },
    {
      '@type': 'type.googleapis.com/google.rpc.LocalizedMessage',
      locale: 'en-US',
      message: 'API key not valid. Please pass a valid API key.'
    }
  ]
}

[90mstdout[2m | tests/outreachAutomation.test.js
[22m[39m[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"

stderr | tests/outreachAutomation.test.js
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

stderr | tests/omnichannel.test.js > Omnichannel Service - Webhooks > GET /api/omni/conversations > deve listar conversas com filtros
[Omni] Erro ao buscar conversas: TypeError: query.where is not a function
    at C:\Users\JE\servio.ai\backend\src\services\omnichannel\index.js:178:33
    at Layer.handle [as handle_request] (C:\Users\JE\servio.ai\backend\node_modules\express\lib\router\layer.js:95:5)
    at next (C:\Users\JE\servio.ai\backend\node_modules\express\lib\router\route.js:149:13)
    at Route.dispatch (C:\Users\JE\servio.ai\backend\node_modules\express\lib\router\route.js:119:3)
    at Layer.handle [as handle_request] (C:\Users\JE\servio.ai\backend\node_modules\express\lib\router\layer.js:95:5)
    at C:\Users\JE\servio.ai\backend\node_modules\express\lib\router\index.js:284:15
    at Function.process_params (C:\Users\JE\servio.ai\backend\node_modules\express\lib\router\index.js:346:12)
    at next (C:\Users\JE\servio.ai\backend\node_modules\express\lib\router\index.js:280:10)
    at Function.handle (C:\Users\JE\servio.ai\backend\node_modules\express\lib\router\index.js:175:3)
    at router (C:\Users\JE\servio.ai\backend\node_modules\express\lib\router\index.js:47:12)

[90mstdout[2m | tests/jobs-pagination.test.js[2m > [22m[2mJobs API Pagination (Task 2.1)[2m > [22m[2mGET /api/jobs - Pagination[2m > [22m[2mshould return first page with default limit of 20
[22m[39m[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"

stderr | tests/jobs-pagination.test.js > Jobs API Pagination (Task 2.1) > GET /api/jobs - Pagination > should return first page with default limit of 20
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

[90mstdout[2m | tests/jobs.test.js
[22m[39m[2025-12-22T16:37:24.450Z] [WARN] Ã”ÃœÃ¡Â´Â©Ã…  WhatsApp credentials not configured - service disabled
[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"
[SERVER] Module loaded as dependency, not starting server

stderr | tests/jobs.test.js
[DB] Ã”ÃœÃ¡Â´Â©Ã…  No Google Cloud Project ID found - usando armazenamento em memâ”œâ”‚ria
[Stripe] STRIPE_SECRET_KEY missing Ã”Ã‡Ã´ Stripe features disabled
Ã”ÃœÃ¡Â´Â©Ã…  SENDGRID_API_KEY nâ”œÃºo configurada - emails nâ”œÃºo serâ”œÃºo enviados
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

[90mstdout[2m | tests/jobs-pagination.test.js[2m > [22m[2mJobs API Pagination (Task 2.1)[2m > [22m[2mGET /api/jobs - Pagination[2m > [22m[2mshould return custom limit when specified
[22m[39m[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"

stderr | tests/jobs-pagination.test.js > Jobs API Pagination (Task 2.1) > GET /api/jobs - Pagination > should return custom limit when specified
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

[90mstdout[2m | tests/jobs.test.js[2m > [22m[2mJobs API Endpoints[2m > [22m[2mPOST /jobs[2m > [22m[2mshould create a new job successfully
[22m[39m[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"

stderr | tests/jobs.test.js > Jobs API Endpoints > POST /jobs > should create a new job successfully
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

[90mstdout[2m | tests/rateLimit.test.js[2m > [22m[2mRate limiting - critical endpoints[2m > [22m[2mretorna 429 quando o limite â”œÂ® excedido
[22m[39m[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"

stderr | tests/rateLimit.test.js > Rate limiting - critical endpoints > retorna 429 quando o limite â”œÂ® excedido
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

[90mstdout[2m | tests/jobs-pagination.test.js[2m > [22m[2mJobs API Pagination (Task 2.1)[2m > [22m[2mGET /api/jobs - Pagination[2m > [22m[2mshould return null cursor when results are less than limit
[22m[39m[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"

stderr | tests/jobs-pagination.test.js > Jobs API Pagination (Task 2.1) > GET /api/jobs - Pagination > should return null cursor when results are less than limit
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

[90mstdout[2m | tests/jobs-pagination.test.js[2m > [22m[2mJobs API Pagination (Task 2.1)[2m > [22m[2mGET /api/jobs - Pagination[2m > [22m[2mshould use cursor for next page pagination
[22m[39m[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"

stderr | tests/jobs-pagination.test.js > Jobs API Pagination (Task 2.1) > GET /api/jobs - Pagination > should use cursor for next page pagination
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

[90mstdout[2m | tests/jobs-pagination.test.js[2m > [22m[2mJobs API Pagination (Task 2.1)[2m > [22m[2mGET /api/jobs - Filtering[2m > [22m[2mshould filter by status
[22m[39m[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"

stderr | tests/jobs-pagination.test.js > Jobs API Pagination (Task 2.1) > GET /api/jobs - Filtering > should filter by status
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

[90mstdout[2m | tests/jobs-pagination.test.js[2m > [22m[2mJobs API Pagination (Task 2.1)[2m > [22m[2mGET /api/jobs - Filtering[2m > [22m[2mshould filter by category
[22m[39m[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"

stderr | tests/jobs-pagination.test.js > Jobs API Pagination (Task 2.1) > GET /api/jobs - Filtering > should filter by category
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

[90mstdout[2m | tests/jobs-pagination.test.js[2m > [22m[2mJobs API Pagination (Task 2.1)[2m > [22m[2mGET /api/jobs - Filtering[2m > [22m[2mshould filter by location
[22m[39m[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"

stderr | tests/jobs-pagination.test.js > Jobs API Pagination (Task 2.1) > GET /api/jobs - Filtering > should filter by location
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

[90mstdout[2m | tests/jobs-pagination.test.js[2m > [22m[2mJobs API Pagination (Task 2.1)[2m > [22m[2mGET /api/jobs - Filtering[2m > [22m[2mshould apply multiple filters
[22m[39m[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"

stderr | tests/jobs-pagination.test.js > Jobs API Pagination (Task 2.1) > GET /api/jobs - Filtering > should apply multiple filters
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

 [31mÃ”Ã˜Â»[39m tests/outreachAutomation.test.js [2m([22m[2m3 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 262[2mms[22m[39m
     [32mÃ”Â£Ã´[39m POST /api/prospector/outreach creates new outreach record[32m 205[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m processPendingOutreach sends WhatsApp for eligible records only[39m[32m 7[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m opt-out prevents follow-up[39m[32m 41[2mms[22m[39m
[90mstdout[2m | tests/jobs.test.js[2m > [22m[2mJobs API Endpoints[2m > [22m[2mGET /jobs[2m > [22m[2mshould filter jobs by status
[22m[39m[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"

stderr | tests/jobs.test.js > Jobs API Endpoints > GET /jobs > should filter jobs by status
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

[90mstdout[2m | tests/jobs-pagination.test.js[2m > [22m[2mJobs API Pagination (Task 2.1)[2m > [22m[2mGET /api/jobs - Sorting[2m > [22m[2mshould sort by createdAt desc by default
[22m[39m[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"

stderr | tests/jobs-pagination.test.js > Jobs API Pagination (Task 2.1) > GET /api/jobs - Sorting > should sort by createdAt desc by default
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

 [31mÃ”Ã˜Â»[39m tests/rateLimit.test.js [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 416[2mms[22m[39m
     [32mÃ”Â£Ã´[39m permite requisiâ”œÂºâ”œÃes dentro do limite configurado[32m 290[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m retorna 429 quando o limite â”œÂ® excedido[39m[32m 118[2mms[22m[39m
[90mstdout[2m | tests/jobs-pagination.test.js[2m > [22m[2mJobs API Pagination (Task 2.1)[2m > [22m[2mGET /api/jobs - Sorting[2m > [22m[2mshould sort by custom field and order
[22m[39m[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"

[90mstdout[2m | tests/jobs.test.js[2m > [22m[2mJobs API Endpoints[2m > [22m[2mPOST /jobs/:jobId/set-on-the-way[2m > [22m[2mshould update job status to "a_caminho"
[22m[39m[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"

stderr | tests/jobs-pagination.test.js > Jobs API Pagination (Task 2.1) > GET /api/jobs - Sorting > should sort by custom field and order
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

stderr | tests/jobs.test.js > Jobs API Endpoints > POST /jobs/:jobId/set-on-the-way > should update job status to "a_caminho"
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

[90mstdout[2m | tests/leaderboardCacheRate.test.js
[22m[39m[2025-12-22T16:37:25.288Z] [WARN] Ã”ÃœÃ¡Â´Â©Ã…  WhatsApp credentials not configured - service disabled
[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"
[SERVER] Module loaded as dependency, not starting server

stderr | tests/leaderboardCacheRate.test.js
[DB] Ã”ÃœÃ¡Â´Â©Ã…  No Google Cloud Project ID found - usando armazenamento em memâ”œâ”‚ria
[Stripe] STRIPE_SECRET_KEY missing Ã”Ã‡Ã´ Stripe features disabled
Ã”ÃœÃ¡Â´Â©Ã…  SENDGRID_API_KEY nâ”œÃºo configurada - emails nâ”œÃºo serâ”œÃºo enviados
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

[90mstdout[2m | tests/prospectorPhase1.test.js
[22m[39m[2025-12-22T16:37:25.355Z] [WARN] Ã”ÃœÃ¡Â´Â©Ã…  WhatsApp credentials not configured - service disabled
[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"
[SERVER] Module loaded as dependency, not starting server

stderr | tests/prospectorPhase1.test.js
[DB] Ã”ÃœÃ¡Â´Â©Ã…  No Google Cloud Project ID found - usando armazenamento em memâ”œâ”‚ria
[Stripe] STRIPE_SECRET_KEY missing Ã”Ã‡Ã´ Stripe features disabled
Ã”ÃœÃ¡Â´Â©Ã…  SENDGRID_API_KEY nâ”œÃºo configurada - emails nâ”œÃºo serâ”œÃºo enviados
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

 [31mÃ”Ã˜Â»[39m tests/omnichannel.test.js [2m([22m[2m14 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 7344[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m deve verificar webhook com challenge correto[39m[33m 3207[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m deve processar mensagem do WhatsApp e salvar no Firestore[39m[33m 2208[2mms[22m[39m
       [33m[2mÃ”Â£Ã´[22m[39m deve processar mensagem do Instagram [33m 413[2mms[22m[39m
       [33m[2mÃ”Â£Ã´[22m[39m deve processar mensagem do Facebook Messenger [33m 639[2mms[22m[39m
       [32mÃ”Â£Ã´[39m deve enviar mensagem via WebChat e receber resposta da IA[32m 294[2mms[22m[39m
       [32mÃ”Â£Ã´[39m deve retornar erro se userId ou message estiverem faltando[32m 26[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m deve listar conversas com filtros[39m[32m 39[2mms[22m[39m
       [32mÃ”Â£Ã´[39m deve listar mensagens de uma conversa[32m 28[2mms[22m[39m
       [32mÃ”Â£Ã´[39m deve retornar erro se conversationId nâ”œÃºo for fornecido[32m 32[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m deve executar trigger followup_48h para clientes inativos[39m[32m 6[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m deve executar trigger followup_proposta para propostas nâ”œÃºo respondidas[39m[32m 7[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m deve executar todas as automaâ”œÂºâ”œÃes via runAutomations[39m[32m 6[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m deve gerar resposta personalizada para cliente[39m[33m 426[2mms[22m[39m
     [32mÃ”Â£Ã´[39m deve adaptar linguagem baseado em userType[32m 1[2mms[22m[39m
[90mstdout[2m | tests/jobs-pagination.test.js[2m > [22m[2mJobs API Pagination (Task 2.1)[2m > [22m[2mGET /jobs (legacy) - Pagination[2m > [22m[2mshould have same pagination behavior as /api/jobs
[22m[39m[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"

stderr | tests/jobs-pagination.test.js > Jobs API Pagination (Task 2.1) > GET /jobs (legacy) - Pagination > should have same pagination behavior as /api/jobs
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

[90mstdout[2m | tests/leaderboardCacheRate.test.js
[22m[39m[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"

stderr | tests/leaderboardCacheRate.test.js
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

[90mstdout[2m | tests/prospectorPhase1.test.js
[22m[39m[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"

stderr | tests/prospectorPhase1.test.js
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

[90mstdout[2m | tests/jobs-pagination.test.js[2m > [22m[2mJobs API Pagination (Task 2.1)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle empty results
[22m[39m[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"

stderr | tests/jobs-pagination.test.js > Jobs API Pagination (Task 2.1) > Edge Cases > should handle empty results
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

[90mstdout[2m | tests/jobs-pagination.test.js[2m > [22m[2mJobs API Pagination (Task 2.1)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle invalid startAfter cursor gracefully
[22m[39m[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"

stderr | tests/jobs-pagination.test.js > Jobs API Pagination (Task 2.1) > Edge Cases > should handle invalid startAfter cursor gracefully
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

 [31mÃ”Ã˜Â»[39m tests/jobs.test.js [2m([22m[2m3 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 494[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should create a new job successfully[32m 294[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should filter jobs by status[39m[32m 140[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should update job status to "a_caminho"[32m 48[2mms[22m[39m
 [31mÃ”Ã˜Â»[39m tests/jobs-pagination.test.js [2m([22m[2m13 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 858[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should return first page with default limit of 20[32m 205[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should return custom limit when specified[32m 54[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should return null cursor when results are less than limit[32m 40[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should use cursor for next page pagination[32m 37[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should filter by status[39m[32m 49[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should filter by category[39m[32m 39[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should filter by location[39m[32m 66[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should apply multiple filters[39m[32m 66[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should sort by createdAt desc by default[39m[32m 58[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should sort by custom field and order[39m[32m 80[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should have same pagination behavior as /api/jobs[39m[32m 58[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should handle empty results[32m 46[2mms[22m[39m
       [32mÃ”Â£Ã´[39m should handle invalid startAfter cursor gracefully[32m 46[2mms[22m[39m
[90mstdout[2m | tests/leaderboardCacheRate.test.js[2m > [22m[2mLeaderboard cache & rate limiting[2m > [22m[2mrate limiting triggers 429 after threshold exceeded
[22m[39m[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"

stderr | tests/leaderboardCacheRate.test.js > Leaderboard cache & rate limiting > rate limiting triggers 429 after threshold exceeded
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

 [32mÃ”Â£Ã´[39m tests/prospectorPhase1.test.js [2m([22m[2m5 tests[22m[2m)[22m[32m 265[2mms[22m[39m
 [32mÃ”Â£Ã´[39m tests/leaderboardCacheRate.test.js [2m([22m[2m3 tests[22m[2m)[22m[33m 392[2mms[22m[39m
[90mstdout[2m | tests/stripeWebhook.test.js
[22m[39m[2025-12-22T16:37:26.183Z] [WARN] Ã”ÃœÃ¡Â´Â©Ã…  WhatsApp credentials not configured - service disabled
[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"
[SERVER] Module loaded as dependency, not starting server

stderr | tests/stripeWebhook.test.js
[DB] Ã”ÃœÃ¡Â´Â©Ã…  No Google Cloud Project ID found - usando armazenamento em memâ”œâ”‚ria
[Stripe] STRIPE_SECRET_KEY missing Ã”Ã‡Ã´ Stripe features disabled
Ã”ÃœÃ¡Â´Â©Ã…  SENDGRID_API_KEY nâ”œÃºo configurada - emails nâ”œÃºo serâ”œÃºo enviados
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

[90mstdout[2m | tests/stripeWebhook.test.js[2m > [22m[2mStripe Webhook (checkout.session.completed)[2m > [22m[2mupdates escrow to pago and sets paymentIntentId
[22m[39m[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"

stderr | tests/stripeWebhook.test.js > Stripe Webhook (checkout.session.completed) > updates escrow to pago and sets paymentIntentId
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

[90mstdout[2m | tests/stripeWebhook.test.js[2m > [22m[2mStripe Webhook (checkout.session.completed)[2m > [22m[2mupdates escrow to pago and sets paymentIntentId
[22m[39m[Stripe Webhook] Event received {
  eventId: [32m'evt_test_1'[39m,
  type: [32m'checkout.session.completed'[39m,
  escrowId: [32m'escrow_123'[39m,
  paymentIntentId: [32m'pi_abc123'[39m
}

[90mstdout[2m | tests/stripeWebhook.test.js[2m > [22m[2mStripe Webhook (checkout.session.completed)[2m > [22m[2mupdates escrow to pago and sets paymentIntentId
[22m[39m[Stripe Webhook] Escrow updated to pago { escrowId: [32m'escrow_123'[39m, paymentIntentId: [32m'pi_abc123'[39m }

[90mstdout[2m | tests/stripeWebhook.test.js[2m > [22m[2mStripe Webhook (checkout.session.completed)[2m > [22m[2mis idempotent (second identical event does not alter data)
[22m[39m[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"

stderr | tests/stripeWebhook.test.js > Stripe Webhook (checkout.session.completed) > is idempotent (second identical event does not alter data)
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

[90mstdout[2m | tests/stripeWebhook.test.js[2m > [22m[2mStripe Webhook (checkout.session.completed)[2m > [22m[2mis idempotent (second identical event does not alter data)
[22m[39m[Stripe Webhook] Event received {
  eventId: [32m'evt_test_1'[39m,
  type: [32m'checkout.session.completed'[39m,
  escrowId: [32m'escrow_123'[39m,
  paymentIntentId: [32m'pi_abc123'[39m
}

[90mstdout[2m | tests/stripeWebhook.test.js[2m > [22m[2mStripe Webhook (checkout.session.completed)[2m > [22m[2mis idempotent (second identical event does not alter data)
[22m[39m[Stripe Webhook] Escrow updated to pago { escrowId: [32m'escrow_123'[39m, paymentIntentId: [32m'pi_abc123'[39m }

[90mstdout[2m | tests/stripeWebhook.test.js[2m > [22m[2mStripe Webhook (checkout.session.completed)[2m > [22m[2mis idempotent (second identical event does not alter data)
[22m[39m[Stripe Webhook] Event received {
  eventId: [32m'evt_test_1'[39m,
  type: [32m'checkout.session.completed'[39m,
  escrowId: [32m'escrow_123'[39m,
  paymentIntentId: [32m'pi_abc123'[39m
}

[90mstdout[2m | tests/stripeWebhook.test.js[2m > [22m[2mStripe Webhook (checkout.session.completed)[2m > [22m[2mis idempotent (second identical event does not alter data)
[22m[39m[Stripe Webhook] Skipping update (already processed) { escrowId: [32m'escrow_123'[39m, paymentIntentId: [32m'pi_abc123'[39m }

 [32mÃ”Â£Ã´[39m tests/stripeWebhook.test.js [2m([22m[2m2 tests[22m[2m)[22m[32m 218[2mms[22m[39m
[90mstdout[2m | src/earnings.test.js
[22m[39m[2025-12-22T16:37:27.401Z] [WARN] Ã”ÃœÃ¡Â´Â©Ã…  WhatsApp credentials not configured - service disabled
[DEPLOY-DEBUG] Root message: "SERVIO.AI Backend v3.0 with Health check"
[SERVER] Module loaded as dependency, not starting server

stderr | src/earnings.test.js
[DB] Ã”ÃœÃ¡Â´Â©Ã…  No Google Cloud Project ID found - usando armazenamento em memâ”œâ”‚ria
[Stripe] STRIPE_SECRET_KEY missing Ã”Ã‡Ã´ Stripe features disabled
Ã”ÃœÃ¡Â´Â©Ã…  SENDGRID_API_KEY nâ”œÃºo configurada - emails nâ”œÃºo serâ”œÃºo enviados
Ã”ÃœÃ¡Â´Â©Ã… Twilio credentials not configured. Service will run in mock mode.

 [32mÃ”Â£Ã´[39m src/earnings.test.js [2m([22m[2m8 tests[22m[2m)[22m[32m 20[2mms[22m[39m

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â» Failed Suites 6 Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»

 FAIL  tests/routes/aiRecommendations.test.js [ tests/routes/aiRecommendations.test.js ]
ReferenceError: jest is not defined
 Ã”Ã˜Â» tests/routes/aiRecommendations.test.js:9:1
      7| 
      8| // Mock do middleware de auth
      9| jest.mock('../middleware/auth', () => ({
       | ^
     10|   requireAuth: (req, res, next) => {
     11|     req.user = {

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[1/69]Ã”Ã„Â»

 FAIL  tests/routes/pipedriveWebhook.test.ts [ tests/routes/pipedriveWebhook.test.ts ]
Error: Cannot find module '/tests/routes/pipedriveWebhook' imported from 'C:/Users/JE/servio.ai/backend/tests/routes/pipedriveWebhook.test.ts'
 Ã”Ã˜Â» tests/routes/pipedriveWebhook.test.ts:8:1
      6| import request from 'supertest';
      7| import express from 'express';
      8| import pipedriveWebhookRouter from '../routes/pipedriveWebhook';
       | ^
      9| 
     10| describe('Pipedrive Webhook Endpoint', () => {

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[2/69]Ã”Ã„Â»

 FAIL  tests/services/aiRecommendationService.test.js [ tests/services/aiRecommendationService.test.js ]
ReferenceError: jest is not defined
 Ã”Ã˜Â» tests/services/aiRecommendationService.test.js:7:1
      5| 
      6| // Mock do Google Generative AI
      7| jest.mock('@google/generative-ai', () => ({
       | ^
      8|   GoogleGenerativeAI: jest.fn(() => ({
      9|     getGenerativeModel: jest.fn(() => ({

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[3/69]Ã”Ã„Â»

 FAIL  tests/services/monitoringService.test.ts [ tests/services/monitoringService.test.ts ]
Error: [vitest] No "default" export is defined on the "firebase-admin" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

vi.mock(import("firebase-admin"), async (importOriginal) => {
  const actual = await importOriginal()
  return {
    ...actual,
    // your mocked methods
  }
})

 Ã”Ã˜Â» src/services/monitoringService.ts:10:12
      8| import { logger } from 'firebase-functions';
      9| 
     10| const db = admin.firestore();
       |            ^
     11| 
     12| export interface MetricData {
 Ã”Ã˜Â» tests/services/monitoringService.test.ts:8:1

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[4/69]Ã”Ã„Â»

 FAIL  tests/services/pipedriveService.test.js [ tests/services/pipedriveService.test.js ]
Error: Cannot find module '../services/pipedriveService'
Require stack:
- C:\Users\JE\servio.ai\backend\tests\services\pipedriveService.test.js
 Ã”Ã˜Â» tests/services/pipedriveService.test.js:6:26
      4| 
      5| import { describe, it, expect, beforeEach, vi } from 'vitest';
      6| const PipedriveService = require('../services/pipedriveService');
       |                          ^
      7| 
      8| describe('PipedriveService', () => {

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[5/69]Ã”Ã„Â»

 FAIL  tests/services/pipedriveService.test.ts [ tests/services/pipedriveService.test.ts ]
Error: Cannot find module '/tests/services/pipedriveService' imported from 'C:/Users/JE/servio.ai/backend/tests/services/pipedriveService.test.ts'
 Ã”Ã˜Â» tests/services/pipedriveService.test.ts:7:1
      5| 
      6| import { describe, it, expect, beforeEach, vi, afterEach } from 'vitesÃ”Ã‡Âª
      7| import { PipedriveService, Lead, Deal } from '../services/pipedriveSerÃ”Ã‡Âª
       | ^
      8| 
      9| // Mock do Firestore

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[6/69]Ã”Ã„Â»


Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â» Failed Tests 63 Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»

 FAIL  tests/followUpService.test.js > followUpService > rate limiting logic (mock environment)
TypeError: __vite_ssr_import_1__.isRateLimited is not a function
 Ã”Ã˜Â» tests/followUpService.test.js:107:34
    105|     }
    106|     // Attempt rate limit check (mock may not enforce chained where prÃ”Ã‡Âª
    107|     const limited = await follow.isRateLimited({ db, prospectorId: 'p4Ã”Ã‡Âª
       |                                  ^
    108|     expect(typeof limited).toBe('boolean');
    109|     const res = await follow.processDueEmails({ db, gmailService: mockÃ”Ã‡Âª

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[7/69]Ã”Ã„Â»

 FAIL  tests/jobs-pagination.test.js > Jobs API Pagination (Task 2.1) > GET /api/jobs - Filtering > should filter by status
AssertionError: expected "vi.fn()" to be called with arguments: [ 'status', '==', 'aberto' ]

Number of calls: 0

 Ã”Ã˜Â» tests/jobs-pagination.test.js:217:31
    215| 
    216|       expect(response.status).toBe(200);
    217|       expect(mockQuery.where).toHaveBeenCalledWith('status', '==', 'abÃ”Ã‡Âª
       |                               ^
    218|     });
    219| 

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[8/69]Ã”Ã„Â»

 FAIL  tests/jobs-pagination.test.js > Jobs API Pagination (Task 2.1) > GET /api/jobs - Filtering > should filter by category
AssertionError: expected "vi.fn()" to be called with arguments: [ 'category', '==', 'Eletricista' ]

Number of calls: 0

 Ã”Ã˜Â» tests/jobs-pagination.test.js:237:31
    235| 
    236|       expect(response.status).toBe(200);
    237|       expect(mockQuery.where).toHaveBeenCalledWith('category', '==', 'Ã”Ã‡Âª
       |                               ^
    238|     });
    239| 

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[9/69]Ã”Ã„Â»

 FAIL  tests/jobs-pagination.test.js > Jobs API Pagination (Task 2.1) > GET /api/jobs - Filtering > should filter by location
AssertionError: expected "vi.fn()" to be called with arguments: [ 'location', '==', 'Sâ”œÃºo Paulo' ]

Number of calls: 0

 Ã”Ã˜Â» tests/jobs-pagination.test.js:257:31
    255| 
    256|       expect(response.status).toBe(200);
    257|       expect(mockQuery.where).toHaveBeenCalledWith('location', '==', 'Ã”Ã‡Âª
       |                               ^
    258|     });
    259| 

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[10/69]Ã”Ã„Â»

 FAIL  tests/jobs-pagination.test.js > Jobs API Pagination (Task 2.1) > GET /api/jobs - Filtering > should apply multiple filters
AssertionError: expected "vi.fn()" to be called with arguments: [ 'status', '==', 'aberto' ]

Received: 

  1st vi.fn() call:

  [
-   "status",
+   "category",
    "==",
-   "aberto",
+   "Eletricista",
  ]

  2nd vi.fn() call:

  [
-   "status",
+   "location",
    "==",
-   "aberto",
+   "Sâ”œÃºo Paulo",
  ]


Number of calls: 2

 Ã”Ã˜Â» tests/jobs-pagination.test.js:283:31
    281| 
    282|       expect(response.status).toBe(200);
    283|       expect(mockQuery.where).toHaveBeenCalledWith('status', '==', 'abÃ”Ã‡Âª
       |                               ^
    284|       expect(mockQuery.where).toHaveBeenCalledWith('category', '==', 'Ã”Ã‡Âª
    285|       expect(mockQuery.where).toHaveBeenCalledWith('location', '==', 'Ã”Ã‡Âª

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[11/69]Ã”Ã„Â»

 FAIL  tests/jobs-pagination.test.js > Jobs API Pagination (Task 2.1) > GET /api/jobs - Sorting > should sort by createdAt desc by default
AssertionError: expected "vi.fn()" to be called with arguments: [ 'createdAt', 'desc' ]

Number of calls: 0

 Ã”Ã˜Â» tests/jobs-pagination.test.js:305:33
    303| 
    304|       expect(response.status).toBe(200);
    305|       expect(mockQuery.orderBy).toHaveBeenCalledWith('createdAt', 'desÃ”Ã‡Âª
       |                                 ^
    306|     });
    307| 

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[12/69]Ã”Ã„Â»

 FAIL  tests/jobs-pagination.test.js > Jobs API Pagination (Task 2.1) > GET /api/jobs - Sorting > should sort by custom field and order
AssertionError: expected "vi.fn()" to be called with arguments: [ 'title', 'asc' ]

Number of calls: 0

 Ã”Ã˜Â» tests/jobs-pagination.test.js:323:33
    321| 
    322|       expect(response.status).toBe(200);
    323|       expect(mockQuery.orderBy).toHaveBeenCalledWith('title', 'asc');
       |                                 ^
    324|     });
    325|   });

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[13/69]Ã”Ã„Â»

 FAIL  tests/jobs-pagination.test.js > Jobs API Pagination (Task 2.1) > GET /jobs (legacy) - Pagination > should have same pagination behavior as /api/jobs
AssertionError: expected "vi.fn()" to be called with arguments: [ 'status', '==', 'aberto' ]

Number of calls: 0

 Ã”Ã˜Â» tests/jobs-pagination.test.js:349:31
    347|       expect(response.body).toHaveProperty('nextPageCursor');
    348|       expect(response.body.jobs).toHaveLength(10);
    349|       expect(mockQuery.where).toHaveBeenCalledWith('status', '==', 'abÃ”Ã‡Âª
       |                               ^
    350|       expect(mockQuery.limit).toHaveBeenCalledWith(10);
    351|     });

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[14/69]Ã”Ã„Â»

 FAIL  tests/jobs.test.js > Jobs API Endpoints > GET /jobs > should filter jobs by status
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Ã”Ã˜Â» tests/jobs.test.js:58:31
     56|       const response = await request(app).get('/jobs?status=aberto');
     57| 
     58|       expect(response.status).toBe(200);
       |                               ^
     59|       expect(response.body).toEqual(mockJobs);
     60|       expect(mockDb.where).toHaveBeenCalledWith('status', '==', 'abertÃ”Ã‡Âª

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[15/69]Ã”Ã„Â»

 FAIL  tests/omnichannel.test.js > Omnichannel Service - Webhooks > POST /api/omni/webhook/whatsapp > deve verificar webhook com challenge correto
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 Ã”Ã˜Â» tests/omnichannel.test.js:165:31
    163|         });
    164| 
    165|       expect(response.status).toBe(200);
       |                               ^
    166|       expect(response.text).toBe('test_challenge_123');
    167|     });

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[16/69]Ã”Ã„Â»

 FAIL  tests/omnichannel.test.js > Omnichannel Service - Webhooks > POST /api/omni/webhook/whatsapp > deve processar mensagem do WhatsApp e salvar no Firestore
AssertionError: expected "vi.fn()" to be called with arguments: [ 'messages' ]

Number of calls: 0

 Ã”Ã˜Â» tests/omnichannel.test.js:194:33
    192| 
    193|       expect(response.status).toBe(200);
    194|       expect(mockDb.collection).toHaveBeenCalledWith('messages');
       |                                 ^
    195|       expect(mockDb.collection).toHaveBeenCalledWith('conversations');
    196|     });

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[17/69]Ã”Ã„Â»

 FAIL  tests/omnichannel.test.js > Omnichannel Service - Webhooks > GET /api/omni/conversations > deve listar conversas com filtros
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Ã”Ã˜Â» tests/omnichannel.test.js:279:31
    277|         .query({ userId: 'user@example.com', userType: 'cliente', limiÃ”Ã‡Âª
    278| 
    279|       expect(response.status).toBe(200);
       |                               ^
    280|       expect(response.body).toHaveProperty('conversations');
    281|       expect(Array.isArray(response.body.conversations)).toBe(true);

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[18/69]Ã”Ã„Â»

 FAIL  tests/omnichannel.test.js > Omnichannel Service - Automaâ”œÂºâ”œÃes > deve executar trigger followup_48h para clientes inativos
 FAIL  tests/omnichannel.test.js > Omnichannel Service - Automaâ”œÂºâ”œÃes > deve executar trigger followup_proposta para propostas nâ”œÃºo respondidas
 FAIL  tests/omnichannel.test.js > Omnichannel Service - Automaâ”œÂºâ”œÃes > deve executar todas as automaâ”œÂºâ”œÃes via runAutomations
TypeError: Cannot read properties of undefined (reading 'fromDate')
 Ã”Ã˜Â» tests/omnichannel.test.js:318:40
    316|         channel: 'whatsapp',
    317|         participants: ['5511999999999', 'omni_ia'],
    318|         lastMessageAt: admin.Timestamp.fromDate(new Date(Date.now() - Ã”Ã‡Âª
       |                                        ^
    319|         lastMessageSender: 'omni_ia',
    320|         status: 'active'

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[19/69]Ã”Ã„Â»

 FAIL  tests/omnichannel.test.js > Omnichannel Service - IA Contextual > deve gerar resposta personalizada para cliente
Error: [GoogleGenerativeAI Error]: Error fetching from https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent: [400 Bad Request] API key not valid. Please pass a valid API key. [{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key not valid. Please pass a valid API key."}]
 Ã”Ã˜Â» handleResponseNotOk node_modules/@google/generative-ai/dist/index.js:434:11
 Ã”Ã˜Â» makeRequest node_modules/@google/generative-ai/dist/index.js:403:9
 Ã”Ã˜Â» generateContent node_modules/@google/generative-ai/dist/index.js:867:22
 Ã”Ã˜Â» tests/omnichannel.test.js:416:20
    414|     const model = genAI.getGenerativeModel({ model: 'gemini-2.0-flash-Ã”Ã‡Âª
    415| 
    416|     const result = await model.generateContent('Teste de contexto paraÃ”Ã‡Âª
       |                    ^
    417|     const response = result.response.text();
    418| 

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[20/69]Ã”Ã„Â»

 FAIL  tests/outreachAutomation.test.js > Prospector outreach automation > processPendingOutreach sends WhatsApp for eligible records only
TypeError: db.collection(...).where is not a function
 Ã”Ã˜Â» processPendingOutreach src/outreachScheduler.js:26:6
     24|   const now = Date.now();
     25|   const outreachQuery = db.collection('prospector_outreach')
     26|     .where('status', '==', 'email_sent')
       |      ^
     27|     .where('optOut', '==', false)
     28|     .where('whatsappSentAt', '==', null)
 Ã”Ã˜Â» tests/outreachAutomation.test.js:102:29

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[21/69]Ã”Ã„Â»

 FAIL  tests/outreachAutomation.test.js > Prospector outreach automation > opt-out prevents follow-up
TypeError: db.collection(...).where is not a function
 Ã”Ã˜Â» processPendingOutreach src/outreachScheduler.js:26:6
     24|   const now = Date.now();
     25|   const outreachQuery = db.collection('prospector_outreach')
     26|     .where('status', '==', 'email_sent')
       |      ^
     27|     .where('optOut', '==', false)
     28|     .where('whatsappSentAt', '==', null)
 Ã”Ã˜Â» tests/outreachAutomation.test.js:124:29

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[22/69]Ã”Ã„Â»

 FAIL  tests/rateLimit.test.js > Rate limiting - critical endpoints > retorna 429 quando o limite â”œÂ® excedido
AssertionError: expected 201 to be 429 // Object.is equality

- Expected
+ Received

- 429
+ 201

 Ã”Ã˜Â» tests/rateLimit.test.js:47:26
     45|     const third = await request(app).post('/proposals').send(payload);
     46| 
     47|     expect(third.status).toBe(429);
       |                          ^
     48|     expect(third.body).toHaveProperty('error');
     49|   });

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[23/69]Ã”Ã„Â»

 FAIL  tests/services/landingPageService.test.ts > LandingPageService > generateLandingPage > should generate landing page successfully
TypeError: __vi_import_0__.default.generateLandingPage is not a function
 Ã”Ã˜Â» tests/services/landingPageService.test.ts:95:45
     93|       };
     94| 
     95|       const page = await LandingPageService.generateLandingPage(briefiÃ”Ã‡Âª
       |                                             ^
     96| 
     97|       expect(page).toBeDefined();

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[24/69]Ã”Ã„Â»

 FAIL  tests/services/landingPageService.test.ts > LandingPageService > generateLandingPage > should include SEO metadata
TypeError: __vi_import_0__.default.generateLandingPage is not a function
 Ã”Ã˜Â» tests/services/landingPageService.test.ts:111:45
    109|       };
    110| 
    111|       const page = await LandingPageService.generateLandingPage(briefiÃ”Ã‡Âª
       |                                             ^
    112| 
    113|       expect(page.metaTitle).toBeDefined();

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[25/69]Ã”Ã„Â»

 FAIL  tests/services/landingPageService.test.ts > LandingPageService > generateLandingPage > should generate FAQ items
TypeError: __vi_import_0__.default.generateLandingPage is not a function
 Ã”Ã˜Â» tests/services/landingPageService.test.ts:127:45
    125|       };
    126| 
    127|       const page = await LandingPageService.generateLandingPage(briefiÃ”Ã‡Âª
       |                                             ^
    128| 
    129|       expect(page.faqs).toBeDefined();

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[26/69]Ã”Ã„Â»

 FAIL  tests/services/landingPageService.test.ts > LandingPageService > generateLandingPage > should generate A/B test variants
TypeError: __vi_import_0__.default.generateLandingPage is not a function
 Ã”Ã˜Â» tests/services/landingPageService.test.ts:143:45
    141|       };
    142| 
    143|       const page = await LandingPageService.generateLandingPage(briefiÃ”Ã‡Âª
       |                                             ^
    144| 
    145|       expect(page.variants).toBeDefined();

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[27/69]Ã”Ã„Â»

 FAIL  tests/services/landingPageService.test.ts > LandingPageService > generateLandingPage > should include all briefing options
TypeError: __vi_import_0__.default.generateLandingPage is not a function
 Ã”Ã˜Â» tests/services/landingPageService.test.ts:160:45
    158|       };
    159| 
    160|       const page = await LandingPageService.generateLandingPage(briefiÃ”Ã‡Âª
       |                                             ^
    161| 
    162|       expect(page.briefing).toEqual(briefing);

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[28/69]Ã”Ã„Â»

 FAIL  tests/services/landingPageService.test.ts > LandingPageService > getLandingPage > should fetch landing page by ID
TypeError: __vi_import_0__.default.getLandingPage is not a function
 Ã”Ã˜Â» tests/services/landingPageService.test.ts:169:45
    167|   describe('getLandingPage', () => {
    168|     it('should fetch landing page by ID', async () => {
    169|       const page = await LandingPageService.getLandingPage('lp_12345');
       |                                             ^
    170| 
    171|       expect(page).toBeDefined();

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[29/69]Ã”Ã„Â»

 FAIL  tests/services/landingPageService.test.ts > LandingPageService > getLandingPage > should return null for non-existent page
TypeError: __vi_import_0__.default.getLandingPage is not a function
 Ã”Ã˜Â» tests/services/landingPageService.test.ts:177:45
    175|     it('should return null for non-existent page', async () => {
    176|       // This depends on mock behavior
    177|       const page = await LandingPageService.getLandingPage('non_existeÃ”Ã‡Âª
       |                                             ^
    178|       expect(page === null || page !== null).toBe(true);
    179|     });

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[30/69]Ã”Ã„Â»

 FAIL  tests/services/landingPageService.test.ts > LandingPageService > getUserLandingPages > should list user landing pages
TypeError: __vi_import_0__.default.getUserLandingPages is not a function
 Ã”Ã˜Â» tests/services/landingPageService.test.ts:184:46
    182|   describe('getUserLandingPages', () => {
    183|     it('should list user landing pages', async () => {
    184|       const pages = await LandingPageService.getUserLandingPages('userÃ”Ã‡Âª
       |                                              ^
    185| 
    186|       expect(Array.isArray(pages)).toBe(true);

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[31/69]Ã”Ã„Â»

 FAIL  tests/services/landingPageService.test.ts > LandingPageService > getUserLandingPages > should respect limit parameter
TypeError: __vi_import_0__.default.getUserLandingPages is not a function
 Ã”Ã˜Â» tests/services/landingPageService.test.ts:191:46
    189| 
    190|     it('should respect limit parameter', async () => {
    191|       const pages = await LandingPageService.getUserLandingPages('userÃ”Ã‡Âª
       |                                              ^
    192| 
    193|       expect(Array.isArray(pages)).toBe(true);

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[32/69]Ã”Ã„Â»

 FAIL  tests/services/landingPageService.test.ts > LandingPageService > recordPageView > should record page view
TypeError: __vi_import_0__.default.recordPageView is not a function
 Ã”Ã˜Â» tests/services/landingPageService.test.ts:200:48
    198|   describe('recordPageView', () => {
    199|     it('should record page view', async () => {
    200|       const success = await LandingPageService.recordPageView('lp_123'Ã”Ã‡Âª
       |                                                ^
    201|       expect(success).toBeUndefined(); // No return, just records
    202|     });

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[33/69]Ã”Ã„Â»

 FAIL  tests/services/landingPageService.test.ts > LandingPageService > recordPageView > should accept any variant
TypeError: __vi_import_0__.default.recordPageView is not a function
 Ã”Ã˜Â» tests/services/landingPageService.test.ts:205:32
    203| 
    204|     it('should accept any variant', async () => {
    205|       await LandingPageService.recordPageView('lp_123', 'A');
       |                                ^
    206|       await LandingPageService.recordPageView('lp_123', 'B');
    207|       await LandingPageService.recordPageView('lp_123', 'C');

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[34/69]Ã”Ã„Â»

 FAIL  tests/services/landingPageService.test.ts > LandingPageService > recordConversion > should record conversion without amount
TypeError: __vi_import_0__.default.recordConversion is not a function
 Ã”Ã˜Â» tests/services/landingPageService.test.ts:214:32
    212|   describe('recordConversion', () => {
    213|     it('should record conversion without amount', async () => {
    214|       await LandingPageService.recordConversion('lp_123', 'A');
       |                                ^
    215|       expect(true).toBe(true);
    216|     });

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[35/69]Ã”Ã„Â»

 FAIL  tests/services/landingPageService.test.ts > LandingPageService > recordConversion > should record conversion with amount
TypeError: __vi_import_0__.default.recordConversion is not a function
 Ã”Ã˜Â» tests/services/landingPageService.test.ts:219:32
    217| 
    218|     it('should record conversion with amount', async () => {
    219|       await LandingPageService.recordConversion('lp_123', 'B', 299.99);
       |                                ^
    220|       expect(true).toBe(true);
    221|     });

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[36/69]Ã”Ã„Â»

 FAIL  tests/services/landingPageService.test.ts > LandingPageService > getABTestResults > should return A/B test results
TypeError: __vi_import_0__.default.getABTestResults is not a function
 Ã”Ã˜Â» tests/services/landingPageService.test.ts:226:48
    224|   describe('getABTestResults', () => {
    225|     it('should return A/B test results', async () => {
    226|       const results = await LandingPageService.getABTestResults('lp_12Ã”Ã‡Âª
       |                                                ^
    227| 
    228|       expect(results === null || results !== null).toBe(true);

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[37/69]Ã”Ã„Â»

 FAIL  tests/services/landingPageService.test.ts > LandingPageService > getABTestResults > should handle missing variants
TypeError: __vi_import_0__.default.getABTestResults is not a function
 Ã”Ã˜Â» tests/services/landingPageService.test.ts:238:48
    236| 
    237|     it('should handle missing variants', async () => {
    238|       const results = await LandingPageService.getABTestResults('lp_noÃ”Ã‡Âª
       |                                                ^
    239|       expect(results === null || results !== null).toBe(true);
    240|     });

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[38/69]Ã”Ã„Â»

 FAIL  tests/services/landingPageService.test.ts > LandingPageService > deleteLandingPage > should delete landing page
TypeError: __vi_import_0__.default.deleteLandingPage is not a function
 Ã”Ã˜Â» tests/services/landingPageService.test.ts:245:48
    243|   describe('deleteLandingPage', () => {
    244|     it('should delete landing page', async () => {
    245|       const success = await LandingPageService.deleteLandingPage('lp_1Ã”Ã‡Âª
       |                                                ^
    246| 
    247|       expect(success).toBe(true);

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[39/69]Ã”Ã„Â»

 FAIL  tests/services/landingPageService.test.ts > LandingPageService > SEO Optimization > should generate SEO-friendly headline
TypeError: __vi_import_0__.default.generateLandingPage is not a function
 Ã”Ã˜Â» tests/services/landingPageService.test.ts:259:45
    257|       };
    258| 
    259|       const page = await LandingPageService.generateLandingPage(briefiÃ”Ã‡Âª
       |                                             ^
    260| 
    261|       expect(page.headline.length).toBeLessThanOrEqual(10);

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[40/69]Ã”Ã„Â»

 FAIL  tests/services/landingPageService.test.ts > LandingPageService > SEO Optimization > should include target keywords
TypeError: __vi_import_0__.default.generateLandingPage is not a function
 Ã”Ã˜Â» tests/services/landingPageService.test.ts:272:45
    270|       };
    271| 
    272|       const page = await LandingPageService.generateLandingPage(briefiÃ”Ã‡Âª
       |                                             ^
    273| 
    274|       const hasKeywords = briefing.keywords.some(

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[41/69]Ã”Ã„Â»

 FAIL  tests/services/landingPageService.test.ts > LandingPageService > Conversion Optimization > should include clear CTA
TypeError: __vi_import_0__.default.generateLandingPage is not a function
 Ã”Ã˜Â» tests/services/landingPageService.test.ts:289:45
    287|       };
    288| 
    289|       const page = await LandingPageService.generateLandingPage(briefiÃ”Ã‡Âª
       |                                             ^
    290| 
    291|       expect(page.cta).toBeDefined();

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[42/69]Ã”Ã„Â»

 FAIL  tests/services/landingPageService.test.ts > LandingPageService > Conversion Optimization > should have compelling subheadline
TypeError: __vi_import_0__.default.generateLandingPage is not a function
 Ã”Ã˜Â» tests/services/landingPageService.test.ts:302:45
    300|       };
    301| 
    302|       const page = await LandingPageService.generateLandingPage(briefiÃ”Ã‡Âª
       |                                             ^
    303| 
    304|       expect(page.subheadline).toBeDefined();

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[43/69]Ã”Ã„Â»

 FAIL  tests/services/landingPageService.test.ts > LandingPageService > Error Handling > should use defaults for missing Gemini response fields
TypeError: __vi_import_0__.default.generateLandingPage is not a function
 Ã”Ã˜Â» tests/services/landingPageService.test.ts:332:45
    330|       };
    331| 
    332|       const page = await LandingPageService.generateLandingPage(briefiÃ”Ã‡Âª
       |                                             ^
    333| 
    334|       expect(page.headline).toBeDefined();

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[44/69]Ã”Ã„Â»

 FAIL  tests/services/twilioService.test.ts > TwilioService > sendSMS > should send SMS successfully with valid payload
TypeError: __vi_import_0__.default.sendSMS is not a function
 Ã”Ã˜Â» tests/services/twilioService.test.ts:64:42
     62|       };
     63| 
     64|       const result = await TwilioService.sendSMS(payload);
       |                                          ^
     65| 
     66|       expect(result.success).toBe(true);

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[45/69]Ã”Ã„Â»

 FAIL  tests/services/twilioService.test.ts > TwilioService > sendSMS > should fail with invalid phone number
TypeError: __vi_import_0__.default.sendSMS is not a function
 Ã”Ã˜Â» tests/services/twilioService.test.ts:78:42
     76|       };
     77| 
     78|       const result = await TwilioService.sendSMS(payload);
       |                                          ^
     79| 
     80|       expect(result.success).toBe(false);

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[46/69]Ã”Ã„Â»

 FAIL  tests/services/twilioService.test.ts > TwilioService > sendSMS > should fail with non-existent template
TypeError: __vi_import_0__.default.sendSMS is not a function
 Ã”Ã˜Â» tests/services/twilioService.test.ts:92:42
     90|       };
     91| 
     92|       const result = await TwilioService.sendSMS(payload);
       |                                          ^
     93| 
     94|       expect(result.success).toBe(false);

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[47/69]Ã”Ã„Â»

 FAIL  tests/services/twilioService.test.ts > TwilioService > sendSMS > should interpolate variables in message
TypeError: __vi_import_0__.default.sendSMS is not a function
 Ã”Ã˜Â» tests/services/twilioService.test.ts:111:42
    109|       };
    110| 
    111|       const result = await TwilioService.sendSMS(payload);
       |                                          ^
    112| 
    113|       expect(result.success).toBe(true);

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[48/69]Ã”Ã„Â»

 FAIL  tests/services/twilioService.test.ts > TwilioService > sendVoiceCall > should initiate voice call successfully
TypeError: __vi_import_0__.default.sendVoiceCall is not a function
 Ã”Ã˜Â» tests/services/twilioService.test.ts:131:42
    129|       };
    130| 
    131|       const result = await TwilioService.sendVoiceCall(payload);
       |                                          ^
    132| 
    133|       expect(result.success).toBe(true);

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[49/69]Ã”Ã„Â»

 FAIL  tests/services/twilioService.test.ts > TwilioService > sendVoiceCall > should fail voice call with invalid phone number
TypeError: __vi_import_0__.default.sendVoiceCall is not a function
 Ã”Ã˜Â» tests/services/twilioService.test.ts:145:42
    143|       };
    144| 
    145|       const result = await TwilioService.sendVoiceCall(payload);
       |                                          ^
    146| 
    147|       expect(result.success).toBe(false);

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[50/69]Ã”Ã„Â»

 FAIL  tests/services/twilioService.test.ts > TwilioService > sendNotification > should send both SMS and voice when channel is "both"
TypeError: __vi_import_0__.default.sendNotification is not a function
 Ã”Ã˜Â» tests/services/twilioService.test.ts:166:42
    164|       };
    165| 
    166|       const result = await TwilioService.sendNotification(payload);
       |                                          ^
    167| 
    168|       expect(result.success).toBe(true);

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[51/69]Ã”Ã„Â»

 FAIL  tests/services/twilioService.test.ts > TwilioService > sendNotification > should send only SMS when channel is "sms"
TypeError: __vi_import_0__.default.sendNotification is not a function
 Ã”Ã˜Â» tests/services/twilioService.test.ts:187:42
    185|       };
    186| 
    187|       const result = await TwilioService.sendNotification(payload);
       |                                          ^
    188| 
    189|       expect(result.success).toBe(true);

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[52/69]Ã”Ã„Â»

 FAIL  tests/services/twilioService.test.ts > TwilioService > getUserCommunicationPreference > should retrieve user communication preferences
TypeError: __vi_import_0__.default.getUserCommunicationPreference is not a function
 Ã”Ã˜Â» tests/services/twilioService.test.ts:195:41
    193|   describe('getUserCommunicationPreference', () => {
    194|     it('should retrieve user communication preferences', async () => {
    195|       const prefs = await TwilioService.getUserCommunicationPreferenceÃ”Ã‡Âª
       |                                         ^
    196| 
    197|       expect(prefs).toBeDefined();

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[53/69]Ã”Ã„Â»

 FAIL  tests/services/twilioService.test.ts > TwilioService > getUserCommunicationPreference > should return null for non-existent user
TypeError: __vi_import_0__.default.getUserCommunicationPreference is not a function
 Ã”Ã˜Â» tests/services/twilioService.test.ts:205:41
    203|     it('should return null for non-existent user', async () => {
    204|       // Mock to return non-existent document
    205|       const prefs = await TwilioService.getUserCommunicationPreferenceÃ”Ã‡Âª
       |                                         ^
    206| 
    207|       // Will depend on mock implementation

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[54/69]Ã”Ã„Â»

 FAIL  tests/services/twilioService.test.ts > TwilioService > updateUserCommunicationPreference > should update communication preferences successfully
TypeError: __vi_import_0__.default.updateUserCommunicationPreference is not a function
 Ã”Ã˜Â» tests/services/twilioService.test.ts:214:43
    212|   describe('updateUserCommunicationPreference', () => {
    213|     it('should update communication preferences successfully', async (Ã”Ã‡Âª
    214|       const success = await TwilioService.updateUserCommunicationPrefeÃ”Ã‡Âª
       |                                           ^
    215|         smsEnabled: false,
    216|         voiceEnabled: true,

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[55/69]Ã”Ã„Â»

 FAIL  tests/services/twilioService.test.ts > TwilioService > updateUserCommunicationPreference > should set preferences with all fields
TypeError: __vi_import_0__.default.updateUserCommunicationPreference is not a function
 Ã”Ã˜Â» tests/services/twilioService.test.ts:223:43
    221| 
    222|     it('should set preferences with all fields', async () => {
    223|       const success = await TwilioService.updateUserCommunicationPrefeÃ”Ã‡Âª
       |                                           ^
    224|         smsEnabled: true,
    225|         voiceEnabled: false,

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[56/69]Ã”Ã„Â»

 FAIL  tests/services/twilioService.test.ts > TwilioService > getTemplates > should return all available templates
TypeError: __vi_import_0__.default.getTemplates is not a function
 Ã”Ã˜Â» tests/services/twilioService.test.ts:236:39
    234|   describe('getTemplates', () => {
    235|     it('should return all available templates', () => {
    236|       const templates = TwilioService.getTemplates();
       |                                       ^
    237| 
    238|       expect(Object.keys(templates).length).toBeGreaterThan(0);

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[57/69]Ã”Ã„Â»

 FAIL  tests/services/twilioService.test.ts > TwilioService > getTemplates > should have proper template structure
TypeError: __vi_import_0__.default.getTemplates is not a function
 Ã”Ã˜Â» tests/services/twilioService.test.ts:247:39
    245| 
    246|     it('should have proper template structure', () => {
    247|       const templates = TwilioService.getTemplates();
       |                                       ^
    248| 
    249|       Object.values(templates).forEach(template => {

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[58/69]Ã”Ã„Â»

 FAIL  tests/services/twilioService.test.ts > TwilioService > addTemplate > should add custom template
TypeError: __vi_import_0__.default.addTemplate is not a function
 Ã”Ã˜Â» tests/services/twilioService.test.ts:267:21
    265|       };
    266| 
    267|       TwilioService.addTemplate(customTemplate);
       |                     ^
    268| 
    269|       const templates = TwilioService.getTemplates();

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[59/69]Ã”Ã„Â»

 FAIL  tests/services/twilioService.test.ts > TwilioService > Error Handling > should handle Twilio API errors gracefully
TypeError: __vi_import_0__.default.sendSMS is not a function
 Ã”Ã˜Â» tests/services/twilioService.test.ts:285:42
    283|       };
    284| 
    285|       const result = await TwilioService.sendSMS(payload);
       |                                          ^
    286| 
    287|       // Should always return a result object with success field

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[60/69]Ã”Ã„Â»

 FAIL  tests/services/twilioService.test.ts > TwilioService > Error Handling > should handle missing Firestore data gracefully
TypeError: __vi_import_0__.default.getUserCommunicationPreference is not a function
 Ã”Ã˜Â» tests/services/twilioService.test.ts:293:42
    291| 
    292|     it('should handle missing Firestore data gracefully', async () => {
    293|       const result = await TwilioService.getUserCommunicationPreferencÃ”Ã‡Âª
       |                                          ^
    294| 
    295|       // Should not throw, but may return null

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[61/69]Ã”Ã„Â»

 FAIL  tests/services/twilioService.test.ts > TwilioService > Variable Interpolation > should replace all template variables
TypeError: __vi_import_0__.default.sendSMS is not a function
 Ã”Ã˜Â» tests/services/twilioService.test.ts:314:42
    312|       };
    313| 
    314|       const result = await TwilioService.sendSMS(payload);
       |                                          ^
    315| 
    316|       expect(result.success).toBe(true);

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[62/69]Ã”Ã„Â»

 FAIL  tests/services/twilioService.test.ts > TwilioService > Variable Interpolation > should handle empty variables object
TypeError: __vi_import_0__.default.sendSMS is not a function
 Ã”Ã˜Â» tests/services/twilioService.test.ts:329:42
    327|       };
    328| 
    329|       const result = await TwilioService.sendSMS(payload);
       |                                          ^
    330| 
    331|       // Should still send but with unreplaced placeholders

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[63/69]Ã”Ã„Â»

 FAIL  tests/services/twilioService.test.ts > TwilioService > Communication Channels > should support SMS channel
TypeError: __vi_import_0__.default.sendNotification is not a function
 Ã”Ã˜Â» tests/services/twilioService.test.ts:345:42
    343|       };
    344| 
    345|       const result = await TwilioService.sendNotification(payload);
       |                                          ^
    346| 
    347|       expect(result.success).toBe(true);

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[64/69]Ã”Ã„Â»

 FAIL  tests/services/twilioService.test.ts > TwilioService > Communication Channels > should support voice channel
TypeError: __vi_import_0__.default.sendNotification is not a function
 Ã”Ã˜Â» tests/services/twilioService.test.ts:358:42
    356|       };
    357| 
    358|       const result = await TwilioService.sendNotification(payload);
       |                                          ^
    359| 
    360|       expect(result.success).toBe(true);

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[65/69]Ã”Ã„Â»

 FAIL  tests/services/twilioService.test.ts > TwilioService > Communication Channels > should support both channels simultaneously
TypeError: __vi_import_0__.default.sendNotification is not a function
 Ã”Ã˜Â» tests/services/twilioService.test.ts:371:42
    369|       };
    370| 
    371|       const result = await TwilioService.sendNotification(payload);
       |                                          ^
    372| 
    373|       expect(result.success).toBe(true);

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[66/69]Ã”Ã„Â»

 FAIL  tests/services/whatsappService.test.ts > WhatsAppService > processIncomingMessage > should escalate unknown queries
AssertionError: expected "vi.fn()" to be called at least once
 Ã”Ã˜Â» tests/services/whatsappService.test.ts:303:30
    301|       await WhatsAppService.processIncomingMessage(body);
    302| 
    303|       expect(mockAxios.post).toHaveBeenCalled();
       |                              ^
    304|       expect(mockFirestoreDocUpdate).toHaveBeenCalledWith(
    305|         expect.objectContaining({

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[67/69]Ã”Ã„Â»


[2m Test Files [22m [1m[31m15 failed[39m[22m[2m | [22m[1m[32m10 passed[39m[22m[90m (25)[39m
[2m      Tests [22m [1m[31m63 failed[39m[22m[2m | [22m[1m[32m125 passed[39m[22m[90m (188)[39m
[2m   Start at [22m 13:37:15
[2m   Duration [22m 13.44s[2m (transform 14.57s, setup 0ms, import 70.30s, tests 12.33s, environment 14ms)[22m

[34m % [39m[2mCoverage report from [22m[33mv8[39m
-------------------|---------|----------|---------|---------|-------------------
File               | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
-------------------|---------|----------|---------|---------|-------------------
All files          |   18.18 |    12.38 |   18.66 |   18.73 |                   
 src               |   16.86 |     14.2 |   21.35 |   17.39 |                   
  ...Middleware.js |   16.32 |     10.2 |   11.76 |   16.66 | ...,95-98,143-300 
  dbWrapper.js     |   77.92 |     52.8 |   88.23 |   77.63 | ...34,304-314,326 
  ...wUpService.js |   55.38 |    46.15 |      50 |   58.62 | ...38-139,156-161 
  gmailService.js  |      55 |    33.33 |   44.44 |      55 | ...03-105,232-234 
  index.js         |    9.81 |      9.9 |     8.5 |    10.1 | ...4232,4240-4403 
  logger.js        |   63.63 |    66.66 |      40 |   63.63 | 11,18,20-21       
  ...hScheduler.js |   20.68 |    23.52 |      50 |   20.68 | 21,32-69          
  stripeConfig.js  |   33.33 |     8.33 |      50 |      40 | 4-7,17-24         
  ...oleService.js |   14.49 |        0 |    7.69 |   14.49 | 187-417           
  ...appService.js |    9.09 |     7.35 |    7.69 |    9.47 | 31-351            
 src/middleware    |   14.41 |     5.88 |    3.84 |   14.54 |                   
  ...Protection.js |   19.23 |     12.5 |      10 |   19.23 | 32,50-51,55-179   
  rateLimiter.js   |      10 |        0 |       0 |      10 | 33-171            
  ...ityHeaders.js |   10.25 |        0 |       0 |   10.52 | 124-231           
 src/routes        |   17.95 |     5.28 |    9.09 |   18.08 |                   
  analytics.js     |      30 |        0 |       0 |      30 | ...38,50-55,67-73 
  crm.js           |   12.63 |        0 |      10 |   12.63 | ...42-277,293-310 
  ecommerce.js     |    15.7 |        0 |    6.66 |   16.37 | ...35-246,255-267 
  ...eAnalytics.js |   18.05 |        0 |      10 |    18.3 | ...32-138,147-153 
  landingPages.js  |   29.75 |    33.33 |   38.46 |   29.75 | ...27-357,365-393 
  scheduler.js     |   31.11 |      100 |       0 |   31.11 | ...25,138-152,164 
  twilio.js        |   12.61 |        0 |    8.33 |   12.61 | ...33-358,370-379 
  whatsapp.js      |   13.88 |        0 |       0 |   13.88 | ...68-173,182-208 
  ...pMultiRole.js |   13.79 |        0 |       0 |   13.79 | ...55-460,469-487 
 src/services      |   12.87 |     6.69 |   14.62 |    13.5 |                   
  ...icsService.js |     4.7 |        0 |       0 |    5.06 | 14-246            
  apiKeyManager.js |    7.93 |     4.76 |    8.33 |    7.93 | 28-265            
  auditLogger.js   |    5.33 |     1.72 |    5.26 |    5.55 | 38-351            
  crmService.js    |       8 |     1.96 |    8.33 |    8.06 | 31,39-575         
  ...icsService.js |    1.35 |        0 |       0 |    1.68 | 13-384            
  ...rceService.js |   24.55 |    27.14 |   31.81 |   24.37 | ...95,404,426-448 
  emailService.js  |    9.63 |       10 |       0 |    9.87 | 15,28-351         
  ...cesService.js |    7.14 |        0 |       0 |    8.16 | 19-241            
  ...ageService.js |    3.72 |     1.04 |    6.25 |    4.08 | 29-555            
  ...ingService.ts |    0.97 |        0 |       0 |    1.02 | 61-414            
  twilioService.js |    3.84 |        0 |    8.33 |    3.84 | 25-504            
  ...appService.ts |    87.2 |    85.18 |     100 |   88.23 | ...41,365,430-431 
 ...es/omnichannel |    80.6 |    65.33 |      95 |   82.27 |                   
  index.js         |    80.6 |    65.33 |      95 |   82.27 | ...33,456,487-499 
 src/validators    |   28.94 |        0 |       0 |   30.55 |                   
  ...Validators.js |   28.94 |        0 |       0 |   30.55 | 39,87,111,217-280 
-------------------|---------|----------|---------|---------|-------------------
